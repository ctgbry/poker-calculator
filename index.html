<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Midnight Gold Poker Toolbox</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: { colors: { ink: "#0F0F0F", gold: "#D4AF37" }, boxShadow: { gold: "0 0 0 1px rgba(212,175,55,.35), 0 16px 40px rgba(0,0,0,.65)" } } }
    }
  </script>
  <style>
    :root { color-scheme: dark; }
    body { background: #0F0F0F; color: #D4AF37; overflow: hidden; touch-action: manipulation; font-family: system-ui, -apple-system, sans-serif; }
    .gold-border { border: 1px solid rgba(212,175,55,.35); }
    .gold-border-strong { border: 2px solid rgba(212,175,55,.9); }
    .gold-glow { text-shadow: 0 0 12px rgba(212,175,55,.6); }
    @keyframes flashGold { 0%, 100% { border-color: rgba(212,175,55,.35); } 50% { border-color: #fffbe0; box-shadow: 0 0 15px rgba(212,175,55,.8); } }
    .flash-gold { animation: flashGold 500ms ease-out; }
    .sheet-backdrop { opacity: 0; pointer-events: none; transition: opacity 220ms ease; background: rgba(0,0,0,.75); backdrop-filter: blur(4px); }
    .sheet-backdrop.on { opacity: 1; pointer-events: auto; }
    .sheet { transform: translateY(100%); transition: transform 280ms cubic-bezier(.2,.9,.2,1); }
    .sheet.on { transform: translateY(0); }
    input::placeholder { color: rgba(212,175,55,0.15); }
    /* 這裡保留你的設定：徹底移除討厭的上下箭頭 */
    input[type="number"]::-webkit-inner-spin-button, 
    input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
  </style>
</head>
<body class="select-none">
  <div id="app" class="h-[100dvh] w-full flex flex-col">
    <header class="pt-[calc(env(safe-area-inset-top)+18px)] pb-3 px-5 flex items-end justify-between">
      <div>
        <div class="text-[10px] tracking-[0.24em] opacity-60">MIDNIGHT GOLD 2.0</div>
        <h1 class="text-[22px] font-bold gold-glow">撲克工具箱</h1>
      </div>
      <div class="text-[10px] opacity-50 font-mono italic">Auto-Reset Enabled</div>
    </header>

    <main class="flex-1 px-4 pb-[calc(env(safe-area-inset-bottom)+14px)]">
      <div class="h-full grid grid-cols-3 grid-rows-3 gap-3">
        <button onclick="openTool('mdf_bet')" class="gold-border-strong rounded-2xl bg-gradient-to-br from-[#1c1c1c] to-[#0c0c0c] active:scale-95 transition-transform shadow-gold">
          <div class="flex flex-col items-center"><span class="text-[14px] font-bold">面對下注</span><span class="text-[11px] opacity-70 gold-glow">MDF</span></div>
        </button>
        <button onclick="openTool('mdf_raise')" class="gold-border rounded-2xl bg-gradient-to-br from-[#171717] to-[#0c0c0c] active:scale-95 transition-transform">
          <div class="flex flex-col items-center"><span class="text-[14px] font-bold">面對加註</span><span class="text-[11px] opacity-70">MDF</span></div>
        </button>
        <button onclick="openTool('spr')" class="gold-border rounded-2xl bg-[#0e0e0e] active:scale-95 transition-transform">
          <div class="flex flex-col items-center"><span class="text-[14px]">下注幾何</span><span class="text-[10px] opacity-50">SPR</span></div>
        </button>
        <button onclick="openTool('odds')" class="gold-border rounded-2xl bg-[#0e0e0e]"><div class="flex flex-col items-center text-[14px]">賠率補牌</div></button>
        <button onclick="openTool('roi')" class="gold-border rounded-2xl bg-[#0e0e0e]"><div class="flex flex-col items-center text-[14px]">賽事成本</div></button>
        <button onclick="openTool('time')" class="gold-border rounded-2xl bg-[#0e0e0e]"><div class="flex flex-col items-center text-[14px]">限時抽水</div></button>
      </div>
    </main>

    <div id="backdrop" class="sheet-backdrop fixed inset-0 z-40" onclick="closeTool()"></div>
    <section id="sheet" class="sheet fixed inset-x-0 bottom-0 h-[82dvh] bg-[#0e0e0e] rounded-t-[32px] border-t border-[rgba(212,175,55,0.4)] shadow-gold z-50 p-6">
      <div class="w-12 h-1.5 bg-white/10 rounded-full mx-auto mb-6"></div>
      <div class="flex justify-between items-start mb-6">
        <div><h2 id="toolTitle" class="text-2xl font-bold gold-glow">--</h2><p id="toolSub" class="text-xs opacity-50 tracking-widest uppercase">--</p></div>
        <button onclick="closeTool()" class="bg-[#1a1a1a] gold-border px-4 py-2 rounded-xl text-xs active:bg-gold active:text-black transition-all">關閉</button>
      </div>

      <div id="mdf_panel" class="space-y-6">
        <div class="grid grid-cols-3 gap-3">
          <div id="potBox" class="bg-[#050505] gold-border rounded-2xl p-3 transition-all"><label class="text-[10px] opacity-50 block mb-1">POT 底池</label><input id="in_pot" type="number" placeholder="0" class="w-full bg-transparent text-xl font-mono outline-none text-gold"></div>
          <div id="betBox" class="bg-[#050505] gold-border rounded-2xl p-3 transition-all"><label class="text-[10px] opacity-50 block mb-1">MY BET</label><input id="in_bet" type="number" placeholder="0" class="w-full bg-transparent text-xl font-mono outline-none text-gold"></div>
          <div id="raiseBox" class="bg-[#050505] gold-border rounded-2xl p-3 transition-all"><label id="label_raise" class="text-[10px] opacity-50 block mb-1">RAISE TO</label><input id="in_raise" type="number" placeholder="0" class="w-full bg-transparent text-xl font-mono outline-none text-gold"></div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div class="space-y-2"><span id="label_quick_bet" class="text-[10px] opacity-40 ml-1 italic">快捷下注 (Bet)</span>
            <div class="grid grid-cols-3 gap-2">
              <button onclick="quickBet(0.33)" class="gold-border rounded-xl py-3 text-xs bg-[#111] active:bg-gold/20 active:scale-95 transition-all">1/3</button>
              <button onclick="quickBet(0.5)" class="gold-border rounded-xl py-3 text-xs bg-[#111] active:bg-gold/20 active:scale-95 transition-all">1/2</button>
              <button onclick="quickBet(1.0)" class="gold-border rounded-xl py-3 text-xs bg-[#111] active:bg-gold/20 active:scale-95 transition-all">Pot</button>
            </div>
          </div>
          <div id="quickRaiseGroup" class="space-y-2"><span class="text-[10px] opacity-40 ml-1 italic">加註倍數 (Raise)</span>
            <div class="grid grid-cols-3 gap-2">
              <button onclick="quickRaise(2.5)" class="gold-border rounded-xl py-3 text-xs bg-[#111] active:bg-gold/20 active:scale-95 transition-all">2.5x</button>
              <button onclick="quickRaise(3)" class="gold-border rounded-xl py-3 text-xs bg-[#111] active:bg-gold/20 active:scale-95 transition-all">3x</button>
              <button onclick="quickRaise(4)" class="gold-border rounded-xl py-3 text-xs bg-[#111] active:bg-gold/20 active:scale-95 transition-all">4x</button>
            </div>
          </div>
        </div>

        <div class="pt-6 border-t border-white/5">
          <div class="flex justify-between items-center"><span id="resultLabel" class="text-sm opacity-60">最低防禦頻率 (MDF)</span><span id="warn_msg" class="text-[10px] text-red-500 font-mono"></span></div>
          <div id="mdf_result" class="text-[68px] font-mono font-bold gold-glow leading-none mt-2">--%</div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // 模組化逻辑字典：不影響 UI，只定義不同工具點擊後的行為
    const TOOLS_CONFIG = {
      mdf_bet: { title: "面對下注", sub: "Facing Bet", label: "最低防禦頻率 (MDF)" },
      mdf_raise: { title: "面對加註", sub: "Facing Raise", label: "最低防禦頻率 (MDF)" },
      spr: { title: "下注幾何", sub: "SPR", label: "Stack-to-Pot Ratio" }
    };

    let currentTool = 'mdf_bet';
    const getV = (id) => parseFloat(document.getElementById(id).value) || 0;

    function resetInputs() {
      document.querySelectorAll('input').forEach(input => input.value = '');
      document.getElementById('mdf_result').textContent = '--%';
      document.getElementById('warn_msg').textContent = '';
    }

    function openTool(toolId) {
      resetInputs();
      currentTool = toolId;
      
      const config = TOOLS_CONFIG[toolId] || { title: "未開發", sub: "Pending", label: "Result" };
      
      // 更新標題
      document.getElementById('toolTitle').textContent = config.title;
      document.getElementById('toolSub').textContent = config.sub;
      document.getElementById('resultLabel').textContent = config.label;
      
      // 核心 UI 切換邏輯 (針對 MDF 系列)
      const isMdfBet = toolId === 'mdf_bet';
      const isSpr = toolId === 'spr';

      // 欄位顯示控制
      document.getElementById('betBox').style.display = (isMdfBet || isSpr) ? 'none' : 'block';
      document.getElementById('label_raise').textContent = isMdfBet ? 'OPP BET' : (isSpr ? 'STACK' : 'RAISE TO');
      
      // 快捷鍵控制
      const qRaise = document.getElementById('quickRaiseGroup');
      qRaise.style.opacity = (isMdfBet || isSpr) ? '0' : '1';
      qRaise.style.pointerEvents = (isMdfBet || isSpr) ? 'none' : 'auto';

      document.getElementById('backdrop').classList.add('on');
      document.getElementById('sheet').classList.add('on');
    }

    function closeTool() {
      document.getElementById('backdrop').classList.remove('on');
      document.getElementById('sheet').classList.remove('on');
      setTimeout(resetInputs, 300);
    }

    function checkPot() {
      if (getV('in_pot') <= 0) {
        document.getElementById('in_pot').value = 1000;
        document.getElementById('potBox').classList.add('flash-gold');
        setTimeout(() => document.getElementById('potBox').classList.remove('flash-gold'), 500);
      }
    }

    function quickBet(frac) {
      checkPot();
      const amount = Math.round(getV('in_pot') * frac);
      if (currentTool === 'mdf_bet' || currentTool === 'spr') {
        document.getElementById('in_raise').value = amount;
      } else {
        document.getElementById('in_bet').value = amount;
      }
      calculate();
    }

    function quickRaise(mult) {
      checkPot();
      const bet = getV('in_bet');
      document.getElementById('in_raise').value = Math.round(bet * mult);
      calculate();
    }

    function calculate() {
      const P = getV('in_pot');
      const B = getV('in_bet');
      const R = getV('in_raise');
      let res = 0;
      let isPercent = true;

      if (currentTool === 'mdf_bet') {
        res = (P + R > 0) ? (P / (P + R)) : 0;
      } else if (currentTool === 'mdf_raise') {
        res = (R + P + B > 0) ? ((P + B) / (R + P + B)) : 0;
      } else if (currentTool === 'spr') {
        res = (P > 0) ? (R / P) : 0;
        isPercent = false;
      }

      const display = isPercent ? (res * 100).toFixed(1) + "%" : res.toFixed(2);
      document.getElementById('mdf_result').textContent = display;
      
      const warn = document.getElementById('warn_msg');
      warn.textContent = (currentTool === 'mdf_raise' && R > 0 && R <= B) ? "RAISE ≤ BET?" : "";
    }

    document.querySelectorAll('input').forEach(input => {
      input.addEventListener('input', calculate);
    });
  </script>
</body>
</html>
