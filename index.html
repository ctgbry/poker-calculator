<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Midnight Gold Poker Toolbox</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: { colors: { ink: "#0F0F0F", gold: "#D4AF37" }, boxShadow: { gold: "0 0 0 1px rgba(212,175,55,.35), 0 16px 40px rgba(0,0,0,.65)" } } }
    }
  </script>
  <style>
    :root { color-scheme: dark; }
    body { background: #0F0F0F; color: #D4AF37; overflow: hidden; touch-action: manipulation; font-family: system-ui, -apple-system, sans-serif; }
    .gold-border { border: 1px solid rgba(212,175,55,.35); }
    .gold-glow { text-shadow: 0 0 12px rgba(212,175,55,.6); }
    .sheet-backdrop { opacity: 0; pointer-events: none; transition: opacity 220ms ease; background: rgba(0,0,0,.75); backdrop-filter: blur(4px); }
    .sheet-backdrop.on { opacity: 1; pointer-events: auto; }
    .sheet { transform: translateY(100%); transition: transform 280ms cubic-bezier(.2,.9,.2,1); }
    .sheet.on { transform: translateY(0); }
    input::placeholder { color: rgba(212,175,55,0.15); }
    input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
  </style>
</head>
<body class="select-none">
  <div id="app" class="h-[100dvh] w-full flex flex-col">
    <header class="pt-[calc(env(safe-area-inset-top)+18px)] pb-3 px-5">
      <div class="text-[10px] tracking-[0.24em] opacity-60">MIDNIGHT GOLD 2.0</div>
      <h1 class="text-[22px] font-bold gold-glow uppercase">Core Toolbox</h1>
    </header>

    <main class="flex-1 px-4 pb-[calc(env(safe-area-inset-bottom)+14px)]">
      <div class="h-full grid grid-cols-3 grid-rows-3 gap-3">
        <button onclick="openTool('mdf_bet')" class="gold-border rounded-2xl bg-[#0e0e0e] active:scale-95 transition-transform">
          <div class="flex flex-col items-center"><span class="text-[14px] font-bold">面對下注</span><span class="text-[11px] opacity-70">MDF</span></div>
        </button>
        <button onclick="openTool('mdf_raise')" class="gold-border rounded-2xl bg-[#0e0e0e] active:scale-95 transition-transform">
          <div class="flex flex-col items-center"><span class="text-[14px] font-bold">面對加註</span><span class="text-[11px] opacity-70">MDF</span></div>
        </button>
        <button onclick="openTool('spr')" class="gold-border rounded-2xl bg-[#0e0e0e] active:scale-95 transition-transform">
          <div class="flex flex-col items-center"><span class="text-[14px] font-bold">下注幾何</span><span class="text-[11px] opacity-70 gold-glow">SPR</span></div>
        </button>
        <button onclick="openTool('odds')" class="gold-border rounded-2xl bg-[#0e0e0e] active:scale-95 transition-transform">
          <div class="flex flex-col items-center"><span class="text-[14px] font-bold">賠率補牌</span><span class="text-[11px] opacity-70 gold-glow">ODDS</span></div>
        </button>
        <div class="gold-border rounded-2xl bg-[#0e0e0e] opacity-30 flex items-center justify-center text-[14px]">賽事成本</div>
        <div class="gold-border rounded-2xl bg-[#0e0e0e] opacity-30 flex items-center justify-center text-[14px]">限時抽水</div>
      </div>
    </main>

    <div id="backdrop" class="sheet-backdrop fixed inset-0 z-40" onclick="closeTool()"></div>
    <section id="sheet" class="sheet fixed inset-x-0 bottom-0 h-[82dvh] bg-[#0e0e0e] rounded-t-[32px] border-t border-[rgba(212,175,55,0.4)] z-50 p-6 overflow-y-auto">
      <div class="w-12 h-1.5 bg-white/10 rounded-full mx-auto mb-6"></div>
      <div id="dynamicTitleArea"></div>
      <div id="dynamicInputArea" class="mt-6 mb-6"></div>
      <div id="dynamicBtnArea" class="mb-6"></div>
      <div id="dynamicResultArea" class="pt-6 border-t border-white/5"></div>
    </section>
  </div>

  <script>
    let currentTool = '';
    let currentStreet = 3;

    function openTool(toolId) {
      currentTool = toolId;
      const titleArea = document.getElementById('dynamicTitleArea');
      const inputArea = document.getElementById('dynamicInputArea');
      const btnArea = document.getElementById('dynamicBtnArea');
      const resultArea = document.getElementById('dynamicResultArea');

      const config = {
        'mdf_bet': { t: '面對下注', s: 'FACING BET', r: '最低防禦頻率 (MDF)' },
        'mdf_raise': { t: '面對加註', s: 'FACING RAISE', r: '最低防禦頻率 (MDF)' },
        'spr': { t: '下注幾何', s: 'GEOMETRIC PLAN', r: '幾何下注比例 (% Pot)' },
        'odds': { t: '賠率補牌', s: 'OUTS & IMPLIED ODDS', r: '跟注決策' }
      }[toolId];
      
      titleArea.innerHTML = `
        <div class="flex justify-between items-start">
          <div><h2 class="text-2xl font-bold gold-glow">${config.t}</h2><p class="text-xs opacity-50 tracking-widest uppercase">${config.s}</p></div>
          <button onclick="closeTool()" class="bg-[#1a1a1a] gold-border px-4 py-2 rounded-xl text-xs active:bg-gold active:text-black">關閉</button>
        </div>`;

      if (toolId === 'odds') {
        inputArea.innerHTML = `
          <div class="grid grid-cols-2 gap-3">
            <div class="bg-[#050505] gold-border rounded-2xl p-3"><label class="text-[10px] opacity-50 block mb-1">OUTS (補牌數)</label><input id="in_outs" type="number" placeholder="9" class="w-full bg-transparent text-xl font-mono outline-none text-gold"></div>
            <div class="bg-[#050505] gold-border rounded-2xl p-3"><label class="text-[10px] opacity-50 block mb-1">對手下注 (倍數Pot)</label><input id="in_bet_size" type="number" placeholder="0.5" class="w-full bg-transparent text-xl font-mono outline-none text-gold"></div>
          </div>`;
        btnArea.innerHTML = `
          <div class="space-y-2"><span class="text-[10px] opacity-40 ml-1 italic">快捷對手下注 (Bet Size %Pot)</span>
            <div class="grid grid-cols-4 gap-2">
              <button onclick="setVal('in_bet_size', 0.33)" class="gold-border rounded-xl py-3 text-xs bg-[#111]">1/3</button>
              <button onclick="setVal('in_bet_size', 0.5)" class="gold-border rounded-xl py-3 text-xs bg-[#111]">1/2</button>
              <button onclick="setVal('in_bet_size', 0.75)" class="gold-border rounded-xl py-3 text-xs bg-[#111]">3/4</button>
              <button onclick="setVal('in_bet_size', 1.0)" class="gold-border rounded-xl py-3 text-xs bg-[#111]">Pot</button>
            </div>
          </div>`;
      } else if (toolId === 'spr') {
        inputArea.innerHTML = `
          <div class="grid grid-cols-2 gap-3">
            <div class="bg-[#050505] gold-border rounded-2xl p-3"><label class="text-[10px] opacity-50 block mb-1">POT 底池</label><input id="in_pot" type="number" placeholder="0" class="w-full bg-transparent text-xl font-mono outline-none text-gold"></div>
            <div class="bg-[#050505] gold-border rounded-2xl p-3"><label class="text-[10px] opacity-50 block mb-1">STACK 餘籌碼</label><input id="in_raise" type="number" placeholder="0" class="w-full bg-transparent text-xl font-mono outline-none text-gold"></div>
          </div>`;
        btnArea.innerHTML = `
          <div class="space-y-2"><span class="text-[10px] opacity-40 ml-1 italic">規劃街數 (Street)</span>
            <div class="grid grid-cols-3 gap-3">
              <button onclick="setStreet(1, this)" class="gold-border rounded-xl py-4 bg-[#111]">1</button>
              <button onclick="setStreet(2, this)" class="gold-border rounded-xl py-4 bg-[#111]">2</button>
              <button onclick="setStreet(3, this)" class="gold-border rounded-xl py-4 bg-gold/10 border-gold/50">3</button>
            </div>
          </div>`;
        currentStreet = 3;
      } else {
        // MDF 系列
        const isBet = toolId === 'mdf_bet';
        inputArea.innerHTML = isBet ? `
          <div class="grid grid-cols-2 gap-3">
            <div class="bg-[#050505] gold-border rounded-2xl p-3"><label class="text-[10px] opacity-50 block mb-1">POT 底池</label><input id="in_pot" type="number" placeholder="0" class="w-full bg-transparent text-xl font-mono outline-none text-gold"></div>
            <div class="bg-[#050505] gold-border rounded-2xl p-3"><label class="text-[10px] opacity-50 block mb-1">OPP BET</label><input id="in_raise" type="number" placeholder="0" class="w-full bg-transparent text-xl font-mono outline-none text-gold"></div>
          </div>` : `
          <div class="grid grid-cols-3 gap-3">
            <div class="bg-[#050505] gold-border rounded-2xl p-3"><label class="text-[10px] opacity-50 block mb-1">POT 底池</label><input id="in_pot" type="number" placeholder="0" class="w-full bg-transparent text-xl font-mono outline-none text-gold"></div>
            <div class="bg-[#050505] gold-border rounded-2xl p-3"><label class="text-[10px] opacity-50 block mb-1">MY BET</label><input id="in_bet" type="number" placeholder="0" class="w-full bg-transparent text-xl font-mono outline-none text-gold"></div>
            <div class="bg-[#050505] gold-border rounded-2xl p-3"><label class="text-[10px] opacity-50 block mb-1">RAISE TO</label><input id="in_raise" type="number" placeholder="0" class="w-full bg-transparent text-xl font-mono outline-none text-gold"></div>
          </div>`;
        btnArea.innerHTML = `
          <div class="grid grid-cols-2 gap-4">
            <div class="space-y-2"><span class="text-[10px] opacity-40 ml-1 italic">快捷下注 (Bet)</span>
              <div class="grid grid-cols-3 gap-2">
                <button onclick="quickBet(0.33)" class="gold-border rounded-xl py-3 text-xs bg-[#111]">1/3</button>
                <button onclick="quickBet(0.5)" class="gold-border rounded-xl py-3 text-xs bg-[#111]">1/2</button>
                <button onclick="quickBet(1.0)" class="gold-border rounded-xl py-3 text-xs bg-[#111]">Pot</button>
              </div>
            </div>
            ${!isBet ? `<div class="space-y-2"><span class="text-[10px] opacity-40 ml-1 italic">加註倍數 (Raise)</span><div class="grid grid-cols-3 gap-2"><button onclick="quickRaise(2.5)" class="gold-border rounded-xl py-3 text-xs bg-[#111]">2.5x</button><button onclick="quickRaise(3)" class="gold-border rounded-xl py-3 text-xs bg-[#111]">3x</button><button onclick="quickRaise(4)" class="gold-border rounded-xl py-3 text-xs bg-[#111]">4x</button></div></div>` : '<div></div>'}
          </div>`;
      }

      resultArea.innerHTML = `
        <div class="flex justify-between items-center"><span class="text-sm opacity-60">${config.r}</span></div>
        <div id="final_result" class="text-[54px] font-mono font-bold gold-glow leading-tight mt-2 whitespace-pre-wrap">--</div>`;

      document.querySelectorAll('input').forEach(i => i.addEventListener('input', calculate));
      document.getElementById('backdrop').classList.add('on');
      document.getElementById('sheet').classList.add('on');
    }

    function calculate() {
      const displayEl = document.getElementById('final_result');
      if (!displayEl) return;

      if (currentTool === 'odds') {
        const outs = parseFloat(document.getElementById('in_outs')?.value) || 0;
        const k = parseFloat(document.getElementById('in_bet_size')?.value) || 0;
        if (outs <= 0 || k <= 0) { displayEl.textContent = "--"; return; }

        const equity = outs / 46; // 一條街精確勝率
        const potOdds = k / (1 + (2 * k));
        
        if (equity >= potOdds) {
          displayEl.innerHTML = `<span class="text-green-400">SNAP CALL</span><br><span class="text-xl opacity-60">EV+ (Direct)</span>`;
        } else {
          // Implied Odds Formula: (Call / Equity) - Total Pot
          // In Pot units: (k / equity) - (1 + 2k)
          const neededPot = (k / equity) - (1 + (2 * k));
          displayEl.innerHTML = `<span class="text-gold">NEED +${neededPot.toFixed(1)} POT</span><br><span class="text-xl opacity-60">To Break-even</span>`;
        }
      } else {
        const P = parseFloat(document.getElementById('in_pot')?.value) || 0;
        const B = parseFloat(document.getElementById('in_bet')?.value) || 0;
        const R = parseFloat(document.getElementById('in_raise')?.value) || 0;
        let res = "--";
        if (currentTool === 'mdf_bet') res = (P + R > 0) ? (P / (P + R) * 100).toFixed(1) + "%" : "--";
        else if (currentTool === 'mdf_raise') res = (R + P + B > 0) ? ((P + B) / (R + P + B) * 100).toFixed(1) + "%" : "--";
        else if (currentTool === 'spr' && P > 0) res = (0.5 * (Math.pow((P + 2 * R) / P, 1 / currentStreet) - 1) * 100).toFixed(2) + "%";
        displayEl.textContent = res;
      }
    }

    function setVal(id, val) { document.getElementById(id).value = val; calculate(); }
    function setStreet(s, el) {
      currentStreet = s;
      const btns = el.parentElement.children;
      for (let b of btns) { b.className = "gold-border rounded-xl py-4 bg-[#111]"; }
      el.className = "gold-border rounded-xl py-4 bg-gold/10 border-gold/50";
      calculate();
    }
    function quickBet(f) {
      const potInput = document.getElementById('in_pot');
      if (!potInput.value) potInput.value = 1000;
      const val = Math.round(parseFloat(potInput.value) * f);
      const target = (currentTool === 'mdf_raise') ? 'in_bet' : 'in_raise';
      document.getElementById(target).value = val;
      calculate();
    }
    function quickRaise(m) {
      const b = parseFloat(document.getElementById('in_bet').value) || 0;
      document.getElementById('in_raise').value = Math.round(b * m);
      calculate();
    }
    function closeTool() {
      document.getElementById('backdrop').classList.remove('on');
      document.getElementById('sheet').classList.remove('on');
    }
  </script>
</body>
</html>
